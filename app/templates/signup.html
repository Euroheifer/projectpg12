<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·æ³¨å†Œ</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- é…ç½® Tailwind CSS ä»¥ä½¿ç”¨ Inter å­—ä½“å’Œè‡ªå®šä¹‰ä¸»é¢˜ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans', 'sans-serif'],
                    },
                    colors: {
                        primary: '#4F46E5', // Indigo-600
                        'primary-dark': '#4338CA', // Indigo-700
                    }
                }
            }
        }
    </script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #F3F4F6;
            /* Light gray background */
            font-family: 'Inter', sans-serif;
        }
    </style>

</head>

<body>

    <!-- æ³¨å†Œè¡¨å•å®¹å™¨ - å“åº”å¼è®¾è®¡ -->
    <div id="signup-container"
        class="w-full max-w-md bg-white shadow-2xl rounded-xl p-8 md:p-10 mx-4 border border-gray-100 transition duration-300 hover:shadow-xl">

        <!-- å¤´éƒ¨/Logo -->
        <div class="text-center mb-8">
            <!-- å‡è®¾çš„ Logo æˆ–å›¾æ ‡ -->
            <svg class="w-12 h-12 text-primary mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
            </svg>
            <h1 class="text-3xl font-extrabold text-gray-900">åˆ›å»ºæ‚¨çš„è´¦æˆ·</h1>
            <p class="mt-2 text-sm text-gray-500">å¿«é€ŸåŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒº</p>
        </div>

        <!-- æ³¨å†Œè¡¨å• -->
        <form id="signup-form">

            <!-- ç”¨æˆ·åè¾“å…¥ (ä¿ç•™ç”¨äºæ˜¾ç¤ºï¼Œä½†APIä¸»è¦ä½¿ç”¨email/password) -->
            <div class="mb-4">
                <label for="username" class="block text-sm font-medium text-gray-700 mb-1">ç”¨æˆ·å</label>
                <input type="text" id="username" name="username" required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-150"
                    placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
            </div>

            <!-- é‚®ç®±è¾“å…¥ -->
            <div class="mb-4">
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">ç”µå­é‚®ç®±</label>
                <input type="email" id="email" name="email" required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-150"
                    placeholder="name@example.com">
            </div>

            <!-- å¯†ç è¾“å…¥ -->
            <div class="mb-4">
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">å¯†ç </label>
                <input type="password" id="password" name="password" required minlength="6"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-150"
                    placeholder="è‡³å°‘6ä½å­—ç¬¦">
            </div>

            <!-- ç¡®è®¤å¯†ç è¾“å…¥ -->
            <div class="mb-6">
                <label for="confirm-password" class="block text-sm font-medium text-gray-700 mb-1">ç¡®è®¤å¯†ç </label>
                <input type="password" id="confirm-password" name="confirm-password" required minlength="6"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-150"
                    placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
            </div>

            <!-- æ¶ˆæ¯æ˜¾ç¤ºåŒº (ä»£æ›¿ alert()) -->
            <div id="message-box" class="hidden p-3 mb-4 rounded-lg text-sm text-center" role="alert"></div>

            <!-- æ³¨å†ŒæŒ‰é’® -->
            <div>
                <button type="submit" id="signup-button"
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition duration-150 transform hover:scale-[1.01] active:scale-[0.99]">
                    ç«‹å³æ³¨å†Œ
                </button>
            </div>
        </form>

        <!-- åº•éƒ¨é“¾æ¥ -->
        <div class="mt-6 text-center text-sm">
            <p class="text-gray-600">
                å·²ç»æ‹¥æœ‰è´¦æˆ·ï¼Ÿ
                <a href="/login" id="login-redirect-link"
                    class="font-medium text-primary hover:text-primary-dark transition duration-150">
                    å»ç™»å½•
                </a>
            </p>
        </div>

    </div>

    <!-- ä¼ ç»Ÿæ¨¡å¼æ³¨å†Œè„šæœ¬ - é¿å…ES6æ¨¡å—å…¼å®¹æ€§é—®é¢˜ -->
    <script>
        console.log('ğŸ”§ å¯ç”¨æ³¨å†Œé¡µé¢ä¼ ç»Ÿæ¨¡å¼...');

        // æ˜¾ç¤ºæ¶ˆæ¯å‡½æ•°
        function showMessage(message, type = 'error') {
            const messageBox = document.getElementById('message-box');
            if (messageBox) {
                messageBox.textContent = message;
                messageBox.className = `p-3 mb-4 rounded-lg text-sm text-center ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
                messageBox.classList.remove('hidden');
                
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 3000);
            }
        }

        // éªŒè¯å¯†ç 
        function validatePasswords() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (password !== confirmPassword) {
                showMessage('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return false;
            }
            
            if (password.length < 6) {
                showMessage('å¯†ç è‡³å°‘éœ€è¦6ä½å­—ç¬¦');
                return false;
            }
            
            return true;
        }

        // æ³¨å†Œå¤„ç†å‡½æ•°
        async function handleSignup(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const signupButton = document.getElementById('signup-button');
            
            if (!username || !email || !password) {
                showMessage('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }
            
            if (!validatePasswords()) {
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            signupButton.textContent = 'æ³¨å†Œä¸­...';
            signupButton.disabled = true;
            
            try {
                const requestData = {
                    username: username,
                    email: email,
                    password: password
                };
                
                const response = await fetch('/auth/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('æ³¨å†ŒæˆåŠŸï¼æ­£åœ¨è·³è½¬åˆ°ç™»å½•é¡µé¢...', 'success');
                    
                    // è·³è½¬åˆ°ç™»å½•é¡µé¢
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                } else {
                    showMessage(data.detail || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            } catch (error) {
                console.error('æ³¨å†Œé”™è¯¯:', error);
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                signupButton.textContent = 'ç«‹å³æ³¨å†Œ';
                signupButton.disabled = false;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåç»‘å®šäº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ³¨å†Œé¡µé¢DOMåŠ è½½å®Œæˆ');
            
            const signupForm = document.getElementById('signup-form');
            if (signupForm) {
                signupForm.addEventListener('submit', handleSignup);
                console.log('âœ… æ³¨å†Œè¡¨å•äº‹ä»¶å·²ç»‘å®š');
            }
            
            // å®æ—¶å¯†ç ç¡®è®¤éªŒè¯
            const confirmPasswordField = document.getElementById('confirm-password');
            if (confirmPasswordField) {
                confirmPasswordField.addEventListener('blur', function() {
                    const password = document.getElementById('password').value;
                    const confirmPassword = this.value;
                    
                    if (confirmPassword && password !== confirmPassword) {
                        showMessage('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                    }
                });
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•
            const token = localStorage.getItem('access_token');
            if (token) {
                console.log('æ£€æµ‹åˆ°å·²ç™»å½•ï¼Œè·³è½¬åˆ°ä¸»é¡µ');
                window.location.href = '/home';
            }
        });

        console.log('âœ… æ³¨å†Œé¡µé¢ä¼ ç»Ÿæ¨¡å¼è„šæœ¬åŠ è½½å®Œæˆ');
    </script>

</body>

</html>