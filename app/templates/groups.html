{% extends "menu.html" %}

{% block title %}Group Details | Project PG12{% endblock %}

{% block head_content %}
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
{% endblock %}

{% block extra_css %}
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
        theme: {
            extend: {
                fontFamily: {
                    sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans', 'sans-serif'],
                },
                colors: {
                    primary: '#4F46E5', // Indigo-600
                    'primary-dark': '#4338CA', // Indigo-700
                    success: '#10B981', // Emerald-500
                    danger: '#F87171', // Red-400
                    warning: '#FBBF24', // Amber-400
                    balance: '#10B981',
                    unbalanced: '#F87171',
                }
            }
        }
    }
</script>
<style>
    body {
        background-color: #F9FAFB;
        font-family: 'Inter', sans-serif;
        min-height: 100vh;
    }

    .balance-card {
        transition: all 0.2s ease-in-out;
    }

    .tab-button.active {
        border-bottom: 3px solid #4F46E5;
        color: #4F46E5;
        font-weight: 600;
    }

    #add-expense-modal input[type="file"],
    #add-payment-modal input[type="file"],
    #expense-detail-modal input[type="file"],
    #payment-detail-modal input[type="file"] {
        display: none;
    }

    .split-toggle-btn {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        font-weight: 700;
        color: #4F46E5;
        background-color: white;
        transition-duration: 0.2s;
        border: none;
        border-right: 1px solid #4F46E5;
    }

    .split-toggle-btn:hover {
        background-color: #4F46E51A;
    }

    .split-toggle-btn.active {
        background-color: #4F46E5 !important;
        color: white !important;
    }

    .split-toggle-btn:last-child {
        border-right: none;
    }

    .recurring-toggle {
        transition: all 0.2s ease-in-out;
    }

    .recurring-options {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-in-out;
    }

    .recurring-options.expanded {
        max-height: 500px;
    }

    .frequency-option {
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 0.75rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .frequency-option:hover {
        border-color: #4F46E5;
        background-color: #f8faff;
    }

    .frequency-option.selected {
        border-color: #4F46E5;
        background-color: #4F46E5;
        color: white;
    }

    .preview-item {
        border-left: 3px solid #4F46E5;
        background-color: #f8faff;
    }

    .participant-checkbox {
        accent-color: #4F46E5;
    }

    .expense-item {
        transition: all 0.2s ease-in-out;
    }

    .expense-item:hover {
        transform: translateY(-2px);
    }

    .readonly-field {
        background-color: #f9fafb;
        cursor: not-allowed;
    }

    .management-menu-active {
        display: block !important;
    }

    /* Permission Control Styles */
    .admin-only {
        display: none;
    }

    .is-admin .admin-only {
        display: block;
    }

    body.is-admin .admin-only {
        display: block;
    }

    .hidden {
        display: none;
    }

    /* Back Button Style */
    .back-button-container {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        z-index: 20;
    }

    .back-button-container {
        position: fixed;
        left: 1rem;
        top: 1rem;
        /* Adjust this value for vertical alignment */
        z-index: 50;
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    }

    /* Ensure main content doesn't overlap with back button */
    main {
        position: relative;
        z-index: 1;
    }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}


<main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-xl border border-gray-100">

        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b pb-4">
            <div class="flex items-center">
                <button onclick="goBackToHome()"
                    class="flex items-center space-x-1 p-2 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150 mr-4">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                        </path>
                    </svg>
                    <span>Back</span>
                </button>

                <h2 id="group-name-display" class="text-3xl font-extrabold text-gray-900 mb-4 sm:mb-0">
                    Loading Group... <span class="text-sm font-normal text-gray-500">(ID: ...)</span>
                </h2>
                </div>
            <div class="flex flex-wrap gap-3 mt-4 sm:mt-0">
                <button onclick="handleAddNewExpense()"
                    class="flex items-center space-x-1 py-2 px-4 rounded-lg text-white bg-primary hover:bg-primary-dark transition duration-150 shadow-md transform hover:scale-[1.02] active:scale-[0.98] text-sm font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span>Add Expense</span>
                </button>

                <button onclick="handleAddNewPayment()"
                    class="flex items-center space-x-1 py-2 px-4 rounded-lg text-white bg-success hover:bg-emerald-600 transition duration-150 shadow-md transform hover:scale-[1.02] active:scale-[0.98] text-sm font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1">
                        </path>
                    </svg>
                    <span>Add Payment</span>
                </button>
            </div>
        </div>

        <div id="group-summary" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="balance-card bg-white p-6 rounded-xl border border-danger/20 shadow-lg">
                <p class="text-sm font-medium text-danger">You Owe (Payable)</p>
                <p class="text-3xl font-bold text-danger mt-1" id="balance-owed">¥0.00</p>
                <p id="balance-owed-context" class="text-xs text-gray-500 mt-2">To 0 members</p>
            </div>

            <div class="balance-card bg-white p-6 rounded-xl border border-success/20 shadow-lg">
                <p class="text-sm font-medium text-success">Others Owe You (Receivable)</p>
                <p class="text-3xl font-bold text-success mt-1" id="balance-owing-me">¥0.00</p>
                <p id="balance-owing-me-context" class="text-xs text-gray-500 mt-2">From 0 members</p>
            </div>

            <div
                class="balance-card bg-white p-6 rounded-xl border border-warning/20 shadow-lg flex flex-col justify-between">
                <div>
                    <p class="text-sm font-medium text-warning">Suggested Settlement</p>
                    <p id="settlement-summary-text" class="text-xl font-bold text-gray-900 mt-1">Loading settlement...</p>
                </div>
                <button onclick="handleSettleUp()"
                    class="w-full py-2 bg-warning/80 text-white rounded-lg hover:bg-warning transition duration-150 shadow-md transform hover:scale-[1.01] active:scale-[0.99] text-sm mt-3">
                    <svg class="w-4 h-4 inline-block mr-1 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 0012 4.499c-3.562 0-6.84 1.838-8.683 4.887m17.566 2h-5.545m-4.021 0h-5.545M5.636 12A8.001 8.001 0 0012 19.5c3.562 0 6.84-1.838 8.683-4.887">
                        </path>
                    </svg>
                    <span>Settle All Debts</span>
                </button>
            </div>
        </div>

        <div class="border-b border-gray-200 mb-6">
            <div class="flex space-x-8 overflow-x-auto">
                <button id="tab-expenses" onclick="setActiveTab('expenses')"
                    class="tab-button active pb-3 px-1 text-gray-500 hover:text-primary transition duration-150 whitespace-nowrap">
                    Expenses (<span id="expense-count">0</span>)
                </button>
                <button id="tab-recurring" onclick="setActiveTab('recurring')"
                    class="tab-button pb-3 px-1 text-gray-500 hover:text-primary transition duration-150 whitespace-nowrap">
                    Recurring (<span id="recurring-count">0</span>)
                </button>
                <button id="tab-payments" onclick="setActiveTab('payments')"
                    class="tab-button pb-3 px-1 text-gray-500 hover:text-primary transition duration-150 whitespace-nowrap">
                    Payments (<span id="payment-count">0</span>)
                </button>
                <button id="tab-members" onclick="setActiveTab('members')"
                    class="tab-button pb-3 px-1 text-gray-500 hover:text-primary transition duration-150 whitespace-nowrap">
                    Members (<span id="member-count">0</span>)
                </button>

                <button id="tab-invite" onclick="setActiveTab('invite')"
                    class="tab-button pb-3 px-1 text-gray-500 hover:text-primary transition duration-150 whitespace-nowrap">
                    Invite Members
                </button>

                <button id="tab-manage" onclick="setActiveTab('manage')"
                    class="tab-button admin-only pb-3 px-1 text-gray-500 hover:text-primary transition duration-150 whitespace-nowrap">
                    Manage Group
                </button>

                <button id="tab-audit" onclick="setActiveTab('audit')"
                    class="tab-button admin-only pb-3 px-1 text-gray-500 hover:text-primary transition duration-150 whitespace-nowrap">
                    Audit Log
                </button>
            </div>
        </div>

        <div id="tab-content-expenses">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Recent Expenses</h3>
            <div id="expenses-list" class="space-y-4">
                <!-- Expenses will be dynamically loaded here by group_page.js -->
            </div>
        </div>

        <div id="tab-content-recurring" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Recurring Expenses</h3>
                <button onclick="handleAddNewRecurringExpense()"
                    class="flex items-center space-x-1 py-2 px-4 rounded-lg text-white bg-warning hover:bg-amber-500 transition duration-150 shadow-md transform hover:scale-[1.02] active:scale-[0.98] text-sm font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span>Add Recurring Expense</span>
                </button>
            </div>
            <div id="recurring-list" class="space-y-4">
                <!-- Recurring expenses will be dynamically loaded here -->
            </div>
        </div>

        <div id="tab-content-payments" class="hidden">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Recent Payments</h3>
            <div id="payments-list" class="space-y-4">
                <!-- Payments will be dynamically loaded here -->
            </div>
        </div>

        <div id="tab-content-members" class="hidden">
            <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center border-b pb-2">
                Group Members (<span id="active-member-count">0</span>)
            </h3>
            <div id="member-list-container" class="space-y-3">
                <!-- Members will be dynamically loaded here by members.js -->
            </div>
        </div>

        <div id="tab-content-invite" class="hidden">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Invite Members</h3>
            <div class="bg-white p-6 rounded-lg border border-gray-200 max-w-lg mx-auto">
                <div class="space-y-4">
                    <p class="text-sm text-gray-600">Please enter the registered email address of the user you wish to invite. The system will send an invitation link to that email.</p>
                    <label for="invite-user-email-input" class="block text-sm font-medium text-gray-700">Email to invite</label>
                    <input type="email" id="invite-user-email-input"
                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                        placeholder="E.g., user@example.com">
                    <p id="invite-loading-message" class="text-sm text-warning hidden">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-warning inline-block"
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        Sending invitation...
                    </p>
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <button onclick="clearInviteForm()"
                        class="py-2 px-4 rounded-lg text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-150 text-sm font-medium">
                        Cancel
                    </button>
                    <button onclick="inviteNewMember()" id="invite-submit-button"
                        class="py-2 px-4 rounded-lg text-white bg-success hover:bg-emerald-600 transition duration-150 shadow-md text-sm font-medium">
                        Send Invite
                    </button>
                </div>
            </div>
        </div>

        <div id="tab-content-manage" class="hidden">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Group Management</h3>
            <div class="bg-white p-6 rounded-lg border border-gray-200">
                <div class="space-y-6">
                    <div class="p-4 bg-gray-50 rounded-lg border">
                        <h4 class="font-medium mb-4 text-lg">Group Information</h4>

                        <div class="space-y-4">
                            <div>
                                <label for="group-name-input" class="block text-sm font-medium text-gray-700 mb-1">
                                    Group Name
                                </label>
                                <input type="text" id="group-name-input"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"
                                    placeholder="Enter group name" value="">
                                <p class="text-xs text-gray-500 mt-1">The group name will be displayed to all members.</p>
                            </div>

                            <div>
                                <label for="group-description-input"
                                    class="block text-sm font-medium text-gray-700 mb-1">
                                    Group Description (Optional)
                                </label>
                                <textarea id="group-description-input" rows="3"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"
                                    placeholder="Describe the purpose of this group..."></textarea>
                            </div>

                            <div class="flex justify-end space-x-3 pt-2">
                                <button type="button" onclick="resetGroupSettings()"
                                    class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition duration-150">
                                    Reset
                                </button>
                                <button type="button" onclick="saveGroupSettings()"
                                    class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition duration-150 shadow-md">
                                    Save Changes
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div id="tab-content-audit" class="hidden">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Audit Log</h3>
            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                <div id="audit-log-content" class="space-y-3">
                    <!-- Audit logs will be dynamically loaded here by group_page.js -->
                </div>
            </div>
        </div>

    </div>
</main>

<div id="custom-alert-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition duration-300 scale-100">
        <p id="alert-message" class="text-lg font-medium mb-4 text-center"></p>
        <button onclick="closeCustomAlert()"
            class="w-full py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition duration-150">OK</button>
    </div>
</div>

<div id="delete-confirm-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition duration-300 scale-100">
        <div class="text-center">
            <div class="w-12 h-12 bg-danger/20 text-danger rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                    </path>
                </svg>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Confirm Deletion</h3>
            <p class="text-sm text-gray-600 mb-6" id="delete-confirm-message">Are you sure you want to delete this expense? This action cannot be undone.</p>

            <div class="flex space-x-3">
                <button onclick="closeDeleteConfirm()"
                    class="flex-1 py-2 px-4 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition duration-150 text-sm font-medium">
                    Cancel
                </button>
                <button onclick="confirmDeleteExpense()"
                    class="flex-1 py-2 px-4 bg-danger text-white rounded-lg hover:bg-red-600 transition duration-150 text-sm font-medium">
                    Confirm Delete
                </button>
            </div>
        </div>
    </div>
</div>

<div id="delete-payment-confirm-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition duration-300 scale-100">
        <div class="text-center">
            <div class="w-12 h-12 bg-danger/20 text-danger rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                    </path>
                </svg>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Confirm Deletion</h3>
            <p class="text-sm text-gray-600 mb-6" id="delete-payment-confirm-message">Are you sure you want to delete this payment? This action cannot be undone.</p>

            <div class="flex space-x-3">
                <button onclick="closeDeletePaymentConfirm()"
                    class="flex-1 py-2 px-4 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition duration-150 text-sm font-medium">
                    Cancel
                </button>
                <button onclick="confirmDeletePayment()"
                    class="flex-1 py-2 px-4 bg-danger text-white rounded-lg hover:bg-red-600 transition duration-150 text-sm font-medium">
                    Confirm Delete
                </button>
            </div>
        </div>
    </div>
</div>

<div id="role-update-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden transition-opacity duration-300">
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4">
        <div class="text-center">
            <div
                class="w-12 h-12 bg-primary/20 text-primary rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Confirm Role Update</h3>
            <p class="text-sm text-gray-600 mb-6" id="role-update-message">Are you sure you want to update the role for member "John Doe"?</p>

            <div class="flex space-x-3">
                <button onclick="cancelUpdateRole()"
                    class="flex-1 py-2 px-4 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition duration-150 text-sm font-medium">
                    Cancel
                </button>
                <button onclick="confirmUpdateRole()"
                    class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark transition duration-150 text-sm font-medium">
                    Confirm Update
                </button>
            </div>
        </div>
    </div>
</div>

<div id="remove-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden transition-opacity duration-300">
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4">
        <div class="text-center">
            <div class="w-12 h-12 bg-danger/20 text-danger rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                    </path>
                </svg>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Confirm Removal</h3>
            <p class="text-sm text-gray-600 mb-6" id="remove-message">Are you sure you want to remove "John Doe" from the group?</p>

            <div class="flex space-x-3">
                <button onclick="cancelRemoveMember()"
                    class="flex-1 py-2 px-4 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition duration-150 text-sm font-medium">
                    Cancel
                </button>
                <button onclick="confirmRemoveMember()"
                    class="flex-1 py-2 px-4 bg-danger text-white rounded-lg hover:bg-red-600 transition duration-150 text-sm font-medium">
                    Confirm Remove
                </button>
            </div>
        </div>
    </div>
</div>

<div id="add-expense-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-40 hidden overflow-y-auto pt-10 pb-10">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl max-w-3xl w-full mx-4 sm:mx-6 lg:mx-8">

        <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-4">Add New Expense</h2>

        <form id="expense-form">

            <div class="space-y-6">

                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">Description / Purpose</label>
                    <input type="text" id="description" name="description" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                        placeholder="E.g., Dinner, Hotel, Groceries">
                </div>

                <div>
                    <label for="amount" class="block text-sm font-medium text-gray-700">Amount ($)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm"> $ </span>
                        </div>
                        <input type="number" id="amount" name="amount" required step="0.01" min="0.01"
                            class="block w-full pl-8 pr-12 border border-gray-300 rounded-md py-2 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                            placeholder="0.00" oninput="handleAmountChange()">
                    </div>
                </div>

                <div>
                    <label for="payer" class="block text-sm font-medium text-gray-700">Who paid?</label>
                    <select id="payer" name="payer" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                        <option value="">Please select payer</option>
                        </select>
                </div>

                <div>
                    <label for="date" class="block text-sm font-medium text-gray-700">Date</label>
                    <input type="date" id="date" name="date" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                </div>

                <div id="participants-section">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Participants (Members to split with)</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <!-- Participants loaded by expense.js -->
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Please select the members who need to split this expense.</p>
                </div>

                <div id="receipt-upload-section">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Receipt / Proof (Optional)</label>
                    <label for="receipt-file"
                        class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-primary hover:bg-primary/5 transition duration-150">
                        <svg class="w-6 h-6 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                        </svg>
                        <span id="file-name-display" class="text-gray-700">Click to upload receipt image (Max 1MB)</span>
                    </label>
                    <input type="file" id="receipt-file" name="receipt-file" accept="image/*"
                        onchange="updateFileNameDisplay(this)">
                    <p class="text-xs text-gray-500 mt-1">Only image formats (JPEG, PNG) are supported.</p>
                </div>

                <div id="split-method-selection" class="border-t pt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-4">How to split the expense?</label>

                    <div
                        class="flex w-full max-w-lg mx-auto rounded-xl overflow-hidden shadow-lg border border-primary">
                        <button type="button" data-method="equal" id="split-equal"
                            class="split-toggle-btn active flex-1">
                            Equally Split
                        </button>
                        <button type="button" data-method="custom" id="split-exact"
                            class="split-toggle-btn flex-1">
                            Custom Amount
                        </button>
                    </div>
                </div>

                <div id="split-details-section" class="mt-6 p-4 bg-gray-50 rounded-lg border">
                    <h4 class="font-semibold mb-2">Split Details (Equally Split)</h4>

                    <div id="split-list" class="space-y-3">
                        <!-- Split details loaded by expense.js -->
                    </div>

                    <div id="split-summary" class="mt-4 pt-3 border-t">
                        <!-- Split summary loaded by expense.js -->
                    </div>
                </div>

            </div>

            <div class="mt-8 border-t pt-6">
                <button type="submit"
                    class="w-full py-3 bg-primary text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-primary-dark transition duration-200 transform hover:scale-[1.005] active:scale-[0.99]">
                    Save Expense
                </button>
                <button type="button" onclick="handleCancel()"
                    class="w-full py-2 mt-2 text-gray-600 bg-gray-100 rounded-xl hover:bg-gray-200 transition duration-150">
                    Cancel
                </button>
            </div>

        </form>
    </div>
</div>

<div id="add-payment-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-40 hidden overflow-y-auto pt-10 pb-10">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl max-w-3xl w-full mx-4 sm:mx-6 lg:mx-8">

        <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-4">Add New Payment</h2>

        <form id="payment-form" onsubmit="savePaymentHandler(event)">

            <div class="space-y-6">

                <div>
                    <label for="payment-description" class="block text-sm font-medium text-gray-700">Payment Description</label>
                    <input type="text" id="payment-description" name="payment-description" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm"
                        placeholder="E.g., Repayment to John, Settling transport fees">
                </div>

                <div>
                    <label for="payment-amount" class="block text-sm font-medium text-gray-700">Payment Amount ($)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm"> $ </span>
                        </div>
                        <input type="number" id="payment-amount" name="payment-amount" required step="0.01" min="0.01"
                            class="block w-full pl-8 pr-12 border border-gray-300 rounded-md py-2 focus:outline-none focus:ring-success focus:border-success sm:text-sm"
                            placeholder="0.00">
                    </div>
                </div>

                <div>
                    <label for="payment-to" class="block text-sm font-medium text-gray-700">Pay to whom?</label>
                    <select id="payment-to" name="payment-to" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm">
                        <option value="">Please select recipient</option>
                        </select>
                </div>

                <div>
                    <label for="payment-for-expense" class="block text-sm font-medium text-gray-700">For which expense?</label>
                    <select id="payment-for-expense" name="payment-for-expense" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm">
                        <option value="">Please select an expense</option>
                        </select>
                </div>

                <div>
                    <label for="payment-payer" class="block text-sm font-medium text-gray-700">Who paid?</label>
                    <select id="payment-payer" name="payment-payer" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm">
                        <option value="">Please select payer</option>
                        </select>
                </div>

                <div>
                    <label for="payment-date" class="block text-sm font-medium text-gray-700">Payment Date</label>
                    <input type="date" id="payment-date" name="payment-date" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm">
                </div>

                <div id="payment-receipt-upload-section">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Payment Proof (Optional)</label>
                    <label for="payment-receipt-file"
                        class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-success hover:bg-success/5 transition duration-150">
                        <svg class="w-6 h-6 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                        </svg>
                        <span id="payment-file-name-display" class="text-gray-700">Click to upload payment proof (Max 1MB)</span>
                    </label>
                    <input type="file" id="payment-receipt-file" name="payment-receipt-file" accept="image/*"
                        onchange="updatePaymentFileNameDisplay(this)">
                    <p class="text-xs text-gray-500 mt-1">Only image formats (JPEG, PNG) are supported.</p>
                </div>

            </div>

            <div class="mt-8 border-t pt-6">
                <button type="submit"
                    class="w-full py-3 bg-success text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-emerald-600 transition duration-200 transform hover:scale-[1.005] active:scale-[0.99]">
                    Save Payment
                </button>
                <button type="button" onclick="handlePaymentCancel()"
                    class="w-full py-2 mt-2 text-gray-600 bg-gray-100 rounded-xl hover:bg-gray-200 transition duration-150">
                    Cancel
                </button>
            </div>

        </form>
    </div>
</div>
<div id="expense-detail-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-40 hidden overflow-y-auto pt-10 pb-10">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl max-w-3xl w-full mx-4 sm:mx-6 lg:mx-8">

        <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-4" id="expense-detail-title">Expense Details</h2>

        <form id="expense-detail-form" onsubmit="updateExpenseHandler(event)">

            <div class="space-y-6">

                <div>
                    <label for="detail-description" class="block text-sm font-medium text-gray-700">Description / Purpose</label>
                    <input type="text" id="detail-description" name="detail-description" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                        placeholder="E.g., Dinner, Hotel, Groceries">
                </div>

                <div>
                    <label for="detail-amount" class="block text-sm font-medium text-gray-700">Amount ($)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm"> $ </span>
                        </div>
                        <input type="number" id="detail-amount" name="detail-amount" required step="0.01" min="0.01"
                            class="block w-full pl-8 pr-12 border border-gray-300 rounded-md py-2 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                            placeholder="0.00" oninput="handleDetailAmountChange()">
                    </div>
                </div>

                <div>
                    <label for="detail-payer" class="block text-sm font-medium text-gray-700">Who paid?</label>
                    <select id="detail-payer" name="detail-payer" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                        <option value="">Please select payer</option>
                        </select>
                </div>

                <div>
                    <label for="detail-date" class="block text-sm font-medium text-gray-700">Date</label>
                    <input type="date" id="detail-date" name="detail-date" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                </div>

                <div id="detail-participants-section">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Participants (Members to split with)</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200"
                        id="detail-participants-container">
                        <!-- Participants loaded by expense.js -->
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Please select the members who need to split this expense.</p>
                </div>
				
				<div id="detail-current-receipt-preview" class="hidden space-y-2">
                    <label class="block text-sm font-medium text-gray-700">Current Receipt</label>
                    <div class="mt-1 w-full p-2 border border-gray-200 rounded-lg bg-gray-50 flex justify-center">
                        <a id="detail-current-receipt-link" href="#" target="_blank" rel="noopener noreferrer">
                            <img id="detail-current-receipt-img" src="" alt="Current Receipt" 
                                 class="max-w-full h-auto max-h-48 rounded shadow-sm object-contain">
                        </a>
                    </div>
                    <p class="text-xs text-gray-500 text-center">Click image to open in new tab</p>
                </div>  
				<div id="detail-split-method-selection" class="border-t pt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-4">How to split the expense?</label>

                    <div
                        class="flex w-full max-w-lg mx-auto rounded-xl overflow-hidden shadow-lg border border-primary">
                        <button type="button" data-method="equal" id="detail-split-equal"
                            class="split-toggle-btn active flex-1">
                            Equally Split
                        </button>
                        <button type="button" data-method="custom" id="detail-split-exact"
                            class="split-toggle-btn flex-1">
                            Custom Amount
                        </button>
                    </div>
                </div>

                <div id="detail-split-details-section" class="mt-6 p-4 bg-gray-50 rounded-lg border">
                    <h4 class="font-semibold mb-2">Split Details (Equally Split)</h4>

                    <div id="detail-split-list" class="space-y-3">
                        <!-- Split details loaded by expense.js -->
                    </div>

                    <div id="detail-split-summary" class="mt-4 pt-3 border-t">
                        <!-- Split summary loaded by expense.js -->
                    </div>
                </div>

            </div>

            <div class="mt-8 border-t pt-6 flex justify-between">
                <button type="button" onclick="handleDeleteExpense()"
                    class="py-3 px-6 bg-danger text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-red-600 transition duration-200">
                    Delete Expense
                </button>
                <div class="flex space-x-3">
                    <button type="button" onclick="handleDetailCancel()"
                        class="py-3 px-6 text-gray-600 bg-gray-100 rounded-xl hover:bg-gray-200 transition duration-150">
                        Cancel
                    </button>
                    <button type="submit"
                        class="py-3 px-6 bg-primary text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-primary-dark transition duration-200">
                        Update Expense
                    </button>
                </div>
            </div>

        </form>
    </div>
</div>

<div id="add-recurring-expense-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-40 hidden overflow-y-auto pt-10 pb-10">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl max-w-3xl w-full mx-4 sm:mx-6 lg:mx-8">

        <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-4">Add Recurring Expense</h2>

        <form id="recurring-expense-form" onsubmit="saveRecurringExpenseHandler(event)">

            <div class="space-y-6">

                <div>
                    <label for="recurring-description" class="block text-sm font-medium text-gray-700">Description / Purpose</label>
                    <input type="text" id="recurring-description" name="recurring-description" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-warning focus:border-warning sm:text-sm"
                        placeholder="E.g., Monthly Rent, Weekly Cleaning">
                </div>

                <div>
                    <label for="recurring-amount" class="block text-sm font-medium text-gray-700">Amount ($)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm"> $ </span>
                        </div>
                        <input type="number" id="recurring-amount" name="recurring-amount" required step="0.01"
                            min="0.01"
                            class="block w-full pl-8 pr-12 border border-gray-300 rounded-md py-2 focus:outline-none focus:ring-warning focus:border-warning sm:text-sm"
                            placeholder="0.00">
                    </div>
                </div>

                <div>
                    <label for="recurring-payer" class="block text-sm font-medium text-gray-700">Who paid?</label>
                    <select id="recurring-payer" name="recurring-payer" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-warning focus:border-warning sm:text-sm">
                        <option value="">Please select payer</option>
                        </select>
                </div>

             <!-- Recurring Expense Settings -->
                <div id="recurring-section" class="border-t pt-6">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700">Recurring Expense Settings</label>
                    </div>

                    <div id="recurring-options" class="recurring-options expanded">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Repeat Frequency</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <div class="frequency-option selected" data-frequency="daily">
                                    <div class="text-center">
                                        <div class="text-lg font-semibold">Daily</div>
                                        <div class="text-xs opacity-75">Repeats every day</div>
                                    </div>
                            </div>
                                <div class="frequency-option" data-frequency="weekly">
                                    <div class="text-center">
                                        <div class="text-lg font-semibold">Weekly</div>
                                        <div class="text-xs opacity-75">Repeats weekly</div>
                                    </div>
                                </div>
                                <div class="frequency-option" data-frequency="monthly">
                                    <div class="text-center">
                                        <div class="text-lg font-semibold">Monthly</div>
                                        <div class="text-xs opacity-75">Repeats monthly</div>
                                    </div>
                                </div>
                                <div class="frequency-option" data-frequency="yearly">
                                    <div class="text-center">
                                        <div class="text-lg font-semibold">Yearly</div>
                                        <div class="text-xs opacity-75">Repeats yearly</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="recurring-settings" class="space-y-4 mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-4">
                                <div>
                                    <label for="repeat-start"
                                        class="block text-sm font-medium text-gray-700">Start Date</label>
                                    <input type="date" id="repeat-start" name="repeat-start" required
                                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-warning focus:border-warning sm:text-sm">
                        </div>
                                <div>
                                    <label for="repeat-end" class="block text-sm font-medium text-gray-700">End Date
                                        (Optional)</label>
                                    <input type="date" id="repeat-end" name="repeat-end"
                                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-warning focus:border-warning sm:text-sm">
                                </div>
                            </div>
                        </div>

                        <div id="recurring-preview" class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-900 mb-3">Expense Preview</h4>
                            <div id="recurring-preview-list" class="space-y-2">
                                <!-- Preview items loaded by recurring_expense.js -->
                            </div>
                            <div id="recurring-preview-summary" class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <!-- Preview summary loaded by recurring_expense.js -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="recurring-participants-section">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Participants (Members to split with)</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <!-- Participants loaded by recurring_expense.js -->
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Please select the members who need to split this expense.</p>
                </div>

                <div id="recurring-split-method-selection" class="border-t pt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-4">How to split the expense?</label>

                    <div
                        class="flex w-full max-w-lg mx-auto rounded-xl overflow-hidden shadow-lg border border-warning">
                         <button type="button" data-method="equal" id="recurring-split-equal"
                            class="split-toggle-btn active flex-1">
                            Equally Split
                        </button>
                        <button type="button" data-method="custom" id="recurring-split-exact"
                            class="split-toggle-btn flex-1">
                            Custom Amount
                        </button>
                    </div>
                </div>

                <div id="recurring-split-details-section" class="mt-6 p-4 bg-gray-50 rounded-lg border">
                    <h4 class="font-semibold mb-2">Split Details (Equally Split)</h4>

                    <div id="recurring-split-list" class="space-y-3">
                        <!-- Split details loaded by recurring_expense.js -->
                    </div>

                    <div id="recurring-split-summary" class="mt-4 pt-3 border-t">
                        <!-- Split summary loaded by recurring_expense.js -->
                    </div>
                </div>

            </div>

            <div class="mt-8 border-t pt-6">
                <button type="submit"
                    class="w-full py-3 bg-warning text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-amber-500 transition duration-200 transform hover:scale-[1.005] active:scale-[0.99]">
                    Save Recurring Expense
                </button>
                <button type="button" onclick="handleRecurringCancel()"
                    class="w-full py-2 mt-2 text-gray-600 bg-gray-100 rounded-xl hover:bg-gray-200 transition duration-150">
                    Cancel
                </button>
            </div>

        </form>
    </div>
</div>

<div id="recurring-detail-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-40 hidden overflow-y-auto pt-10 pb-10">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl max-w-3xl w-full mx-4 sm:mxg:mx-8">

        <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-4" id="recurring-detail-title">Recurring Expense Details</h2>

        <div class="space-y-6">

            <div>
                <label class="block text-sm font-medium text-gray-700">Description / Purpose</label>
                <p class="mt-1 text-gray-900 font-medium" id="recurring-detail-description">Monthly Rent</p>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Amount ($)</label>
                <p class="mt-1 text-gray-900 font-medium" id="recurring-detail-amount">$1500.00</p>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Who paid?</label>
                <p class="mt-1 text-gray-900" id="recurring-detail-payer">John Doe</p>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Frequency</label>
                <p class="mt-1 text-gray-900" id="recurring-detail-frequency">Monthly</p>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Start Date</label>
                <p class="mt-1 text-gray-900" id="recurring-detail-start-date">2025-11-01</p>
            </div>

            <div id="recurring-detail-end-date-container">
                <label class="block text-sm font-medium text-gray-700">End Date</label>
                <p class="mt-1 text-gray-900" id="recurring-detail-end-date">2026-10-31</p>
        </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Status</label>
                <div class="mt-1">
                    <span id="recurring-detail-status"
                        class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-success/10 text-success">
                        Active
                    </span>
                </div>
            </div>

            <div id="recurring-detail-participants-section">
                <label class="block text-sm font-medium text-gray-700 mb-3">Participants (Members to split with)</label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200"
                    id="recurring-detail-participants-container">
                    <!-- Participants loaded by recurring_expense.js -->
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Split Method</label>
                <p class="text-gray-900" id="recurring-detail-split-method">Equally Split</p>
            </div>

            <div id="recurring-detail-split-details-section" class="mt-6 p-4 bg-gray-50 rounded-lg border">
                <h4 class="font-semibold mb-2">Split Details</h4>

                <div id="recurring-detail-split-list" class="space-y-3">
                    <!-- Split details loaded by recurring_expense.js -->
                </div>
            </div>

        </div>

        <div class="pt-6 flex justify-between">
            <div class="flex space-x-3">
                <button onclick="handleDisableRecurringExpense()" id="disable-recurring-btn"
                    class="py-3 px-6 bg-gray-600 text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-gray-700 transition duration-200">
                    Disable
                </button>
                <button onclick="handleEnableRecurringExpense()" id="enable-recurring-btn" class="hidden py-3 px-6 bg-success text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-emerald-600 transition duration-200">
                    Enable
                </button>
                <button onclick="handleDeleteRecurringExpense()"
                    class="py-3 px-6 bg-danger text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-red-600 transition duration-200">
                    Delete Recurring Expense
                </button>
            </div>
            <div class="flex space-x-3">
                <button onclick="handleRecurringDetailCancel()"
                    class="py-3 px-6 text-gray-600 bg-gray-100 rounded-xl hover:bg-gray-200 transition duration-150">
                    Close
                </button>
                <button onclick="handleEditRecurringExpense()"
                    class="py-3 px-6 bg-warning text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-amber-500 transition duration-200">
                    Edit Recurring Expense
                </button>
            </div>
        </div>

    </div>
</div>



<div id="payment-detail-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-40 hidden overflow-y-auto pt-10 pb-10">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl max-w-3xl w-full mx-4 sm:mx-6 lg:mx-8">

        <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-4" id="payment-detail-title">Payment Details</h2>
        
        <form id="payment-detail-form" onsubmit="updatePaymentHandler(event)">

        <div class="space-y-6">

                <div>
                    <label for="payment-detail-description" class="block text-sm font-medium text-gray-700">Payment Description</label>
                    <input type="text" id="payment-detail-description" name="payment-detail-description" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm"
                        placeholder="E.g., Repayment to John, Settling transport fees">
                </div>

                <div>
                    <label for="payment-detail-amount" class="block text-sm font-medium text-gray-700">Payment Amount ($)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm"> $ </span>
                        </div>
                        <input type="number" id="payment-detail-amount" name="payment-detail-amount" required
                            step="0.01" min="0.01"
                            class="block w-full pl-8 pr-12 border border-gray-300 rounded-md py-2 focus:outline-none focus:ring-success focus:border-success sm:text-sm"
                            placeholder="0.00">
                    </div>
                </div>

                <div>
                    <label for="payment-detail-to" class="block text-sm font-medium text-gray-700">Pay to whom?</label>
            <select id="payment-detail-to" name="payment-detail-to" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm">
                        <option value="">Please select recipient</option>
                        </select>
                </div>

                <div>
                    <label for="payment-detail-for-expense"
                        class="block text-sm font-medium text-gray-700">For which expense?</label>
                    <select id="payment-detail-for-expense" name="payment-detail-for-expense" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm">
                        <option value="">Please select an expense</option>
                        </select>
                </div>

                <div>
                    <label for="payment-detail-payer" class="block text-sm font-medium text-gray-700">Who paid?</label>
                    <select id="payment-detail-payer" name="payment-detail-payer" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm">
                        <option value="">Please select payer</option>
                        </select>
                </div>

                <div>
                    <label for="payment-detail-date" class="block text-sm font-medium text-gray-700">Payment Date</label>
                    <input type="date" id="payment-detail-date" name="payment-detail-date" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-success focus:border-success sm:text-sm">
                </div>

                <div id="payment-detail-receipt-upload-section">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Payment Proof (Optional)</label>
                    <label for="payment-detail-receipt-file"
                        class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-success hover:bg-success/5 transition duration-150">
                        <svg class="w-6 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                        </svg>
                        <span id="payment-detail-file-name-display" class="text-gray-700">Click to upload payment proof (Max 1MB)</span>
                    </label>
                    <input type="file" id="payment-detail-receipt-file" name="payment-detail-receipt-file"
                        accept="image/*" onchange="updatePaymentDetailFileNameDisplay(this)">
                    <p class="text-xs text-gray-500 mt-1">Only image formats (JPEG, PNG) are supported.</p>
                </div>

            </div>

            <div class="mt-8 border-t pt-6 flex justify-between">
                <button type="button" onclick="handleDeletePayment()"
                    class="py-3 px-6 bg-danger text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-red-600 transition duration-200">
                    Delete Payment
                </button>
                <div class="flex space-x-3">
                    <button type="button" onclick="handlePaymentDetailCancel()"
                        class="py-3 px-6 text-gray-600 bg-gray-100 rounded-xl hover:bg-gray-200 transition duration-150">
                        Cancel
                    </button>
        <button type="submit"
                        class="py-3 px-6 bg-success text-white text-lg font-semibold rounded-xl shadow-lg hover:bg-emerald-600 transition duration-200">
                        Update Payment
                    </button>
                </div>
            </div>

        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}

<script type="module" src="/static/js/ui/utils.js"></script>
<script type="module" src="/static/js/api/expense.js"></script>
<script type="module" src="/static/js/api/recurring_expense.js"></script>
<script type="module" src="/static/js/api/payment.js"></script>
<script type="module" src="/static/js/api/settlement.js"></script>
<script type="module" src="/static/js/api/members.js"></script>
<script type="module" src="/static/js/api/groups.js"></script>
<script type="module" src="/static/js/page/group_page.js"></script>


{% endblock %}