<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>群组管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #F9FAFB;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column; 
        }

        .dashboard-card { 
            transition: all 0.2s ease-in-out; 
        }
        
        .group-card { 
            transition: all 0.2s ease-in-out; 
            cursor: pointer; 
        }
        
        .group-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            width: 100%;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        
        .content-wrapper {
            max-width: 80rem; 
            width: 100%;
            padding-left: 1rem;
            padding-right: 1rem;
            margin: 0 auto; 
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 替换皇冠管理员标识为简单的红色徽章 */
        .admin-badge {
            background: #FEE2E2;
            color: #DC2626;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
        }
    </style>
</head>

<body>

    <nav class="bg-white shadow-md w-full">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="relative flex justify-end h-16">
                
                <!-- 居中标题 -->
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <span class="text-xl font-bold text-gray-900 pointer-events-auto">群组管理系统</span>
                </div>

                <!-- 右侧用户菜单 -->
                <div class="flex items-center relative z-10" id="user-menu-container">
                    
                    <button id="user-display-button" onclick="toggleUserMenu()"
                        class="flex items-center space-x-1 p-2 rounded-lg text-gray-700 font-medium text-sm hover:bg-gray-100 transition duration-150 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                        <span id="user-display">张三</span> 
                        <svg id="caret-icon" class="w-4 h-4 ml-1 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>

                    <div id="logout-dropdown" class="absolute right-0 top-full mt-2 w-40 bg-white rounded-lg shadow-xl py-1 z-10 hidden border border-gray-100">
                        
                        <button onclick="handleMyProfile(); toggleUserMenu();"
                            class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150 flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            <span>我的资料</span>
                        </button>
                        
                        <button onclick="handleBackToDashboard(); toggleUserMenu();"
                            class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150 flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            <span>主页</span>
                        </button>

                        <button onclick="showLogoutConfirmation()"
                            class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 transition duration-150 flex items-center space-x-2 border-t border-gray-100 mt-1 pt-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3v-3m0-6V7a3 3 0 013-3h4"></path></svg>
                            <span>退出登录</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>


    <main>
        <div class="content-wrapper">
            <div class="space-y-6">
                
                <!-- 待处理邀请卡片 -->
                <div class="dashboard-card bg-white shadow-xl rounded-xl p-6 border-t-4 border-indigo-500 fade-in">
                    <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-100">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fa-solid fa-envelope-open-text text-indigo-500 mr-2"></i>
                            待处理的群组邀请
                        </h2>
                        <button id="simulate-invite-btn"
                            class="px-3 py-1.5 text-xs bg-blue-700 text-white font-semibold rounded-lg hover:bg-blue-800 transition duration-150 transform hover:scale-[1.02]">
                            <i class="fa-solid fa-bell-concierge mr-1"></i> 模拟新邀请
                        </button>
                    </div>

                    <div id="invitation-list-container" class="min-h-[150px]">
                        <div id="loading-state" class="text-center p-8 hidden">
                            <i class="fa-solid fa-spinner fa-spin-pulse text-4xl text-indigo-500"></i>
                            <p class="text-gray-600 mt-3">正在加载邀请...</p>
                        </div>
                        <div id="empty-state" class="text-center p-6 text-gray-500">
                            <i class="fa-solid fa-inbox text-5xl text-gray-300 mb-3"></i>
                            <p class="mt-2">您当前没有待处理的邀请。</p>
                        </div>
                    </div>
                </div>

                <!-- 我的群组卡片 -->
                <div class="dashboard-card bg-white shadow-xl rounded-xl p-6 border-t-4 border-indigo-500 fade-in">
                    <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-100">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fa-solid fa-list-check text-indigo-500 mr-2"></i>
                            我的群组
                        </h2>
                        <div class="flex space-x-3">
                            <!-- 移除了邀请朋友按钮 -->
                            <button onclick="handleCreateGroup()"
                                class="flex items-center space-x-1 py-1 px-3 rounded-lg text-white bg-emerald-500 hover:bg-emerald-600 transition duration-150 text-sm shadow-md">
                                <i class="fa-solid fa-plus w-3 h-3"></i>
                                <span>创建群组</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="my-groups-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[100px]">
                        <!-- 群组卡片将在此处渲染 -->
                    </div>
                    <p id="groups-empty-state" class="text-center p-4 text-gray-500">
                        您还没有加入任何群组。
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- 自定义弹窗 -->
    <div id="custom-alert-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div
            class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition duration-300 scale-100">
            <p id="alert-message" class="text-lg font-medium mb-4 text-center"></p>
            <button onclick="closeCustomAlert()"
                class="w-full py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition duration-150">确定</button>
        </div>
    </div>

    <!-- 退出登录确认弹窗 -->
    <div id="logout-confirm-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div
            class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition duration-300 scale-100">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3v-3m0-6V7a3 3 0 013-3h4"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">确认退出登录</h3>
                <p class="text-gray-600">您确定要退出登录吗？退出后需要重新登录才能访问您的群组。</p>
            </div>
            <div class="flex space-x-3">
                <button onclick="closeLogoutConfirm()"
                    class="flex-1 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition duration-150 font-medium">
                    取消
                </button>
                <button onclick="confirmLogout()"
                    class="flex-1 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-150 font-medium">
                    确认退出
                </button>
            </div>
        </div>
    </div>

    <!-- 创建群组弹窗 -->
    <div id="create-group-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div
            class="bg-white p-6 rounded-xl shadow-2xl max-w-md w-full transform transition duration-300 scale-100">
            <h3 class="text-xl font-bold mb-4 text-center">创建新群组</h3>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-medium mb-2" for="group-name">
                    群组名称
                </label>
                <input id="group-name" type="text" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    placeholder="输入群组名称">
            </div>
            <div class="flex space-x-3">
                <button onclick="closeCreateGroupModal()"
                    class="flex-1 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition duration-150">取消</button>
                <button onclick="createNewGroup()"
                    class="flex-1 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition duration-150">创建</button>
            </div>
        </div>
    </div>

    <script>
        // 演示数据 - 现在包含管理员信息
        let demoInvitations = [
            {
                id: '1',
                groupId: 'trip-europe-2024',
                groupName: '欧洲毕业旅行 2024',
                inviterName: '李四',
                timestamp: Date.now() - 86400000 // 1天前
            },
            {
                id: '2', 
                groupId: 'basketball-weekend',
                groupName: '周末篮球俱乐部',
                inviterName: '王五',
                timestamp: Date.now() - 172800000 // 2天前
            }
        ];

        let demoGroups = [
            {
                id: '1',
                groupId: 'family-dinner',
                groupName: '家庭聚餐',
                balance: 125.50,
                memberCount: 4,
                isAdmin: true,  // 这个群组用户是管理员
                createdBy: '张三'
            },
            {
                id: '2',
                groupId: 'office-lunch',
                groupName: '办公室午餐',
                balance: -45.00,
                memberCount: 8,
                isAdmin: false,  // 这个群组用户不是管理员
                createdBy: '李四'
            },
            {
                id: '3',
                groupId: 'project-team',
                groupName: '项目团队',
                balance: 0,
                memberCount: 6,
                isAdmin: true,  // 这个群组用户是管理员
                createdBy: '张三'
            }
        ];

        // 初始化函数
        function initializeApp() {
            renderInvitations();
            renderGroups();
            
            // 设置模拟邀请按钮事件
            document.getElementById('simulate-invite-btn').onclick = seedMockInvitations;
        }

        // 渲染邀请列表
        function renderInvitations() {
            const container = document.getElementById('invitation-list-container');
            const emptyState = document.getElementById('empty-state');
            
            // 清除旧的列表项
            const oldItems = container.querySelectorAll('.invitation-item');
            oldItems.forEach(el => el.remove());
            
            if (demoInvitations.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');

            // 添加新的邀请项
            demoInvitations.forEach((invite, index) => {
                const borderClass = index > 0 ? 'border-t border-gray-200' : '';
                const dateString = new Date(invite.timestamp).toLocaleDateString();
                
                const inviteElement = document.createElement('div');
                inviteElement.className = `invitation-item flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 ${borderClass} fade-in`;
                inviteElement.innerHTML = `
                    <div class="mb-4 sm:mb-0">
                        <h3 class="text-base font-semibold text-gray-800 flex items-center">
                            <i class="fa-solid fa-users text-indigo-500 mr-2"></i>
                            ${invite.groupName}
                        </h3>
                        <p class="text-xs text-gray-500 mt-1 ml-6">
                            邀请人: <span class="font-medium text-gray-600">${invite.inviterName}</span>
                            <span class="text-xs ml-2 text-gray-400">(${dateString})</span>
                        </p>
                    </div>
                    <div class="flex space-x-3 w-full sm:w-auto">
                        <button onclick="handleAccept('${invite.id}', '${invite.groupId}', '${invite.groupName}')"
                            class="flex-1 sm:flex-none px-3 py-1.5 bg-emerald-500 text-white text-sm font-medium rounded-lg shadow-md hover:bg-emerald-600 transition transform hover:scale-[1.02]">
                            <i class="fa-solid fa-check mr-1"></i> 接受
                        </button>
                        <button onclick="handleDecline('${invite.id}')"
                            class="flex-1 sm:flex-none px-3 py-1.5 bg-red-400 text-white text-sm font-medium rounded-lg shadow-md hover:bg-red-500 transition transform hover:scale-[1.02]">
                            <i class="fa-solid fa-xmark mr-1"></i> 拒绝
                        </button>
                    </div>
                `;
                
                container.appendChild(inviteElement);
            });
        }

        // 渲染群组列表 - 移除小人图标和"您创建了这个群组"文字，改为重定向
        function renderGroups() {
            const container = document.getElementById('my-groups-list');
            const emptyState = document.getElementById('groups-empty-state');
            
            container.innerHTML = '';
            
            if (demoGroups.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');

            demoGroups.forEach(group => {
                const owes = group.balance < 0;
                const balance = Math.abs(group.balance).toFixed(2);
                const balanceColor = owes ? 'text-red-400' : 'text-emerald-500';
                const balanceText = owes ? `您欠 ¥${balance}` : `您被欠 ¥${balance}`;
                
                const groupElement = document.createElement('div');
                groupElement.className = 'group-card bg-white p-5 rounded-xl border border-gray-200 shadow-md hover:bg-gray-50 fade-in';
                // 改为重定向函数
                groupElement.onclick = () => redirectToGroupDetail(group.id, group.groupName);
                
                groupElement.innerHTML = `
                    <div class="mb-3">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl font-bold text-gray-900 truncate">${group.groupName}</h3>
                            ${group.isAdmin ? '<span class="admin-badge">管理员</span>' : ''}
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 mb-2">成员: ${group.memberCount} 人</p>
                    <div class="flex items-center space-x-2 pt-2 border-t border-gray-100">
                        <span class="${balanceColor} font-bold text-base">结余: ${balanceText}</span>
                        <svg class="w-5 h-5 ${balanceColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                d="${owes ? 'M19 9l-7 7-7-7' : 'M5 15l7-7 7 7'}"></path>
                        </svg>
                    </div>
                `;
                
                container.appendChild(groupElement);
            });
        }

        // 重定向到群组详情页 - 占位函数
        function redirectToGroupDetail(groupId, groupName) {
            console.log(`重定向到群组详情页: ${groupName} (ID: ${groupId})`);
            // 这里将来可以替换为实际的重定向逻辑
            // window.location.href = `/group-detail.html?id=${groupId}`;
            
            // 暂时用弹窗提示
            customAlert('重定向提示', `正在跳转到群组 "${groupName}" 的详情页面...\n\n实际应用中这里会重定向到群组详情页。`);
        }

        // 退出登录确认功能
        function showLogoutConfirmation() {
            // 先关闭用户菜单
            toggleUserMenu();
            // 显示退出确认弹窗
            const modal = document.getElementById('logout-confirm-modal');
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        function closeLogoutConfirm() {
            const modal = document.getElementById('logout-confirm-modal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        function confirmLogout() {
            // 关闭确认弹窗
            closeLogoutConfirm();
            
            // 执行退出登录逻辑
            console.log('用户确认退出登录');
            
            // 这里可以添加实际的退出登录逻辑，比如：
            // 清除本地存储的token
            // 调用后端退出接口
            // 重定向到登录页
            
            // 暂时用弹窗提示
            customAlert('退出登录', '您已成功退出登录！正在跳转到登录页面...');
            
            // 模拟重定向到登录页（实际使用时取消注释）
            // setTimeout(() => {
            //     window.location.href = '/login.html';
            // }, 2000);
        }

        // 模拟新邀请
        function seedMockInvitations() {
            const newInvite = {
                id: Date.now().toString(),
                groupId: 'group-' + Date.now(),
                groupName: '新群组 ' + new Date().toLocaleTimeString(),
                inviterName: '系统管理员',
                timestamp: Date.now()
            };
            
            demoInvitations.push(newInvite);
            renderInvitations();
            customAlert('新邀请', '您已收到一条新的群组邀请！');
        }

        // 接受邀请
        function handleAccept(invitationId, groupId, groupName) {
            // 从邀请列表中移除
            demoInvitations = demoInvitations.filter(invite => invite.id !== invitationId);
            
            // 添加到群组列表 - 新加入的群组默认不是管理员
            const newGroup = {
                id: groupId,
                groupId: groupId,
                groupName: groupName,
                balance: 0,
                memberCount: 1,
                isAdmin: false,
                createdBy: '其他人'
            };
            
            demoGroups.push(newGroup);
            
            // 更新UI
            renderInvitations();
            renderGroups();
            
            customAlert('成功', `已成功接受邀请！您已加入群组 **${groupName}**。`);
        }

        // 拒绝邀请
        function handleDecline(invitationId) {
            demoInvitations = demoInvitations.filter(invite => invite.id !== invitationId);
            renderInvitations();
            customAlert('成功', '已成功拒绝邀请。');
        }

        // 创建群组
        function handleCreateGroup() {
            document.getElementById('create-group-modal').classList.remove('hidden');
        }

        function closeCreateGroupModal() {
            document.getElementById('create-group-modal').classList.add('hidden');
            document.getElementById('group-name').value = '';
        }

        function createNewGroup() {
            const groupName = document.getElementById('group-name').value.trim();
            
            if (!groupName) {
                customAlert('错误', '请输入群组名称');
                return;
            }
            
            // 创建群组时，创建者自动成为管理员
            const newGroup = {
                id: 'group-' + Date.now(),
                groupId: 'group-' + Date.now(),
                groupName: groupName,
                balance: 0,
                memberCount: 1,
                isAdmin: true,
                createdBy: '张三'
            };
            
            demoGroups.push(newGroup);
            renderGroups();
            closeCreateGroupModal();
            customAlert('成功', `群组 "${groupName}" 创建成功！您是该群组的管理员。`);
        }

        // 用户菜单功能
        let isMenuOpen = false;

        function toggleUserMenu() {
            isMenuOpen = !isMenuOpen;
            const dropdown = document.getElementById('logout-dropdown');
            const caret = document.getElementById('caret-icon');
            
            if (isMenuOpen) {
                dropdown.classList.remove('hidden');
                caret.classList.add('rotate-180');
            } else {
                dropdown.classList.add('hidden');
                caret.classList.remove('rotate-180');
            }
        }
        
        document.addEventListener('click', (event) => {
            const menuContainer = document.getElementById('user-menu-container');
            if (isMenuOpen && menuContainer && !menuContainer.contains(event.target)) {
                 toggleUserMenu(); 
            }
        });

        // 弹窗功能
        function customAlert(title, message) {
            const modal = document.getElementById('custom-alert-modal');
            const msgElement = document.getElementById('alert-message');
            msgElement.innerHTML = `<strong>${title}</strong><br>${String(message)}`;
            modal.classList.remove('hidden');
        }

        function closeCustomAlert() {
            document.getElementById('custom-alert-modal').classList.add('hidden');
        }

        // 占位符处理函数
        function handleMyProfile() {
            customAlert('跳转提示', '正在跳转到**我的资料**页面... (功能待实现)');
        }

        function handleBackToDashboard() {
            customAlert('提示', '您已经在**主页**了。');
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>