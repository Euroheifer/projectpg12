<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·ç™»å½•</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- é…ç½® Tailwind CSS ä»¥ä½¿ç”¨ Inter å­—ä½“å’Œè‡ªå®šä¹‰ä¸»é¢˜ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans', 'sans-serif'],
                    },
                    colors: {
                        primary: '#4F46E5', // Indigo-600
                        'primary-dark': '#4338CA', // Indigo-700
                    }
                }
            }
        }
    </script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #F3F4F6;
            /* Light gray background */
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body>

    <!-- ç™»å½•è¡¨å•å®¹å™¨ - å“åº”å¼è®¾è®¡ -->
    <div id="login-container"
        class="w-full max-w-md bg-white shadow-2xl rounded-xl p-8 md:p-10 mx-4 border border-gray-100 transition duration-300 hover:shadow-xl">

        <!-- å¤´éƒ¨/Logo -->
        <div class="text-center mb-8">
            <!-- å‡è®¾çš„ Logo æˆ–å›¾æ ‡ -->
            <svg class="w-12 h-12 text-primary mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3v-3m0-4v-1a3 3 0 013-3h7a3 3 0 013 3v1">
                </path>
            </svg>
            <h1 class="text-3xl font-extrabold text-gray-900">æ¬¢è¿å›æ¥ï¼Œè¯·ç™»å½•</h1>
            <p class="mt-2 text-sm text-gray-500">è¾“å…¥æ‚¨çš„å‡­è¯ä»¥ç»§ç»­</p>
        </div>

        <!-- ç™»å½•è¡¨å• -->
        <form id="login-form">

            <!-- é‚®ç®±è¾“å…¥ (æ³¨æ„ï¼šåç§°è®¾ä¸º username ä»¥åŒ¹é… OAuth2PasswordRequestForm) -->
            <div class="mb-4">
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">ç”µå­é‚®ç®±</label>
                <input type="email" id="email" name="username" required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-150"
                    placeholder="name@example.com">
            </div>

            <!-- å¯†ç è¾“å…¥ -->
            <div class="mb-6">
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">å¯†ç </label>
                <input type="password" id="password" name="password" required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-150"
                    placeholder="æ‚¨çš„å¯†ç ">
            </div>

            <!-- æ¶ˆæ¯æ˜¾ç¤ºåŒº (ä»£æ›¿ alert()) -->
            <div id="message-box" class="hidden p-3 mb-4 rounded-lg text-sm text-center" role="alert"></div>

            <!-- ç™»å½•æŒ‰é’® -->
            <div>
                <button type="submit" id="login-button"
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition duration-150 transform hover:scale-[1.01] active:scale-[0.99]">
                    ç«‹å³ç™»å½•
                </button>
            </div>
        </form>

        <!-- åº•éƒ¨é“¾æ¥ -->
        <div class="mt-6 text-center text-sm">
            <p class="text-gray-600">
                è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ
                <a href="/signup" id="signup-redirect-link"
                    class="font-medium text-primary hover:text-primary-dark transition duration-150">
                    å»æ³¨å†Œ
                </a>
            </p>
        </div>

    </div>

    <!-- ä¼ ç»Ÿæ¨¡å¼ç™»å½•è„šæœ¬ - é¿å…ES6æ¨¡å—å…¼å®¹æ€§é—®é¢˜ -->
    <script>
        console.log('ğŸ”§ å¯ç”¨ç™»å½•é¡µé¢ä¼ ç»Ÿæ¨¡å¼...');

        // æ˜¾ç¤ºæ¶ˆæ¯å‡½æ•°
        function showMessage(message, type = 'error') {
            const messageBox = document.getElementById('message-box');
            if (messageBox) {
                messageBox.textContent = message;
                messageBox.className = `p-3 mb-4 rounded-lg text-sm text-center ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
                messageBox.classList.remove('hidden');
                
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 3000);
            }
        }

        // ç™»å½•å¤„ç†å‡½æ•°
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const loginButton = document.getElementById('login-button');
            
            if (!email || !password) {
                showMessage('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loginButton.textContent = 'ç™»å½•ä¸­...';
            loginButton.disabled = true;
            
            try {
                const formData = new FormData();
                formData.append('username', email);
                formData.append('password', password);
                
                const response = await fetch('/token', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // ä¿å­˜token
                    localStorage.setItem('access_token', data.access_token);
                    showMessage('ç™»å½•æˆåŠŸï¼æ­£åœ¨è·³è½¬...', 'success');
                    
                    // è·³è½¬åˆ°ä¸»é¡µ
                    setTimeout(() => {
                        window.location.href = '/home';
                    }, 1000);
                } else {
                    showMessage(data.detail || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ');
                }
            } catch (error) {
                console.error('ç™»å½•é”™è¯¯:', error);
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                loginButton.textContent = 'ç«‹å³ç™»å½•';
                loginButton.disabled = false;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåç»‘å®šäº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç™»å½•é¡µé¢DOMåŠ è½½å®Œæˆ');
            
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
                console.log('âœ… ç™»å½•è¡¨å•äº‹ä»¶å·²ç»‘å®š');
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•
            const token = localStorage.getItem('access_token');
            if (token) {
                console.log('æ£€æµ‹åˆ°å·²ç™»å½•ï¼Œè·³è½¬åˆ°ä¸»é¡µ');
                window.location.href = '/home';
            }
        });

        console.log('âœ… ç™»å½•é¡µé¢ä¼ ç»Ÿæ¨¡å¼è„šæœ¬åŠ è½½å®Œæˆ');
    </script>

</body>

</html>