# æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§ç³»ç»Ÿ

æœ¬é¡¹ç›®åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š`performance.js` å’Œ `analytics.js`ï¼Œä¸ºå‰ç«¯åº”ç”¨æä¾›å…¨é¢çš„æ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·è¡Œä¸ºåˆ†æåŠŸèƒ½ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
frontend/js/
â”œâ”€â”€ performance.js     # æ€§èƒ½ä¼˜åŒ–æ¨¡å—
â”œâ”€â”€ analytics.js       # ç”¨æˆ·è¡Œä¸ºåˆ†ææ¨¡å—
â””â”€â”€ æ€§èƒ½ç›‘æ§æ¨¡å—è¯´æ˜.md  # æœ¬è¯´æ˜æ–‡æ¡£
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–æ¨¡å— (performance.js)

### æ ¸å¿ƒåŠŸèƒ½

- **ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½**
- **å†…å­˜æ³„æ¼æ£€æµ‹å’Œæ¸…ç†**
- **å›¾ç‰‡æ‡’åŠ è½½å’Œä¼˜åŒ–**
- **ç½‘ç»œè¯·æ±‚ç¼“å­˜å’Œä¼˜åŒ–**
- **æ€§èƒ½æŒ‡æ ‡ç›‘æ§ï¼ˆLCPã€FIDã€CLSç­‰ï¼‰**

### ä¸»è¦ç‰¹æ€§

#### 1. æ ¸å¿ƒWeb Vitalsç›‘æ§
```javascript
// è‡ªåŠ¨ç›‘æ§LCPã€FIDã€CLSæŒ‡æ ‡
window.performanceManager.getMetrics()
```

#### 2. å†…å­˜ç®¡ç†
```javascript
// æ£€æµ‹å†…å­˜æ³„æ¼
window.performanceManager.detMemoryLeaks()

// æ¸…ç†ç¼“å­˜å’Œç›‘å¬å™¨
window.performanceManager.cleanup()
```

#### 3. å›¾ç‰‡æ‡’åŠ è½½
```html
<img data-src="image.jpg" alt="Lazy loaded image">
```

#### 4. ç½‘ç»œè¯·æ±‚ç›‘æ§
```javascript
// è‡ªåŠ¨ç›‘æ§æ‰€æœ‰ç½‘ç»œè¯·æ±‚
window.performanceManager.logNetworkRequest(requestData)
```

#### 5. ä»£ç åˆ†å‰²
```javascript
// åŠ¨æ€å¯¼å…¥æ¨¡å—
window.dynamicImport('./module.js').then(module => {
    // ä½¿ç”¨æ¨¡å—
});
```

### ä½¿ç”¨ç¤ºä¾‹

```javascript
// åˆå§‹åŒ–æ€§èƒ½ç®¡ç†å™¨
const performanceManager = new PerformanceManager();

// æ‡’åŠ è½½ç»„ä»¶
performanceManager.lazyLoadComponent(document.querySelector('#component'), 
    () => import('./Component.js'));

// ç¼“å­˜APIå“åº”
performanceManager.cacheApiResponse('users', userData, 300000);
```

## ğŸ“Š ç”¨æˆ·è¡Œä¸ºåˆ†ææ¨¡å— (analytics.js)

### æ ¸å¿ƒåŠŸèƒ½

- **é¡µé¢è®¿é—®å’Œç”¨æˆ·è¡Œä¸ºè·Ÿè¸ª**
- **åŠŸèƒ½ä½¿ç”¨ç»Ÿè®¡å’ŒæŠ¥å‘Š**
- **é”™è¯¯ç›‘æ§å’ŒæŠ¥å‘Š**
- **æ€§èƒ½æŒ‡æ ‡ç›‘æ§**
- **ç”¨æˆ·æ»¡æ„åº¦è°ƒæŸ¥**

### ä¸»è¦ç‰¹æ€§

#### 1. é¡µé¢è®¿é—®è·Ÿè¸ª
```javascript
// è‡ªåŠ¨è·Ÿè¸ªé¡µé¢è®¿é—®
analyticsManager.trackPageView();

// è‡ªå®šä¹‰é¡µé¢æ•°æ®
analyticsManager.trackPageView({
    category: 'product',
    pageType: 'detail'
});
```

#### 2. ç”¨æˆ·è¡Œä¸ºåˆ†æ
```javascript
// è·Ÿè¸ªç”¨æˆ·äº¤äº’
analyticsManager.trackInteraction(element, 'click', {
    x: event.clientX,
    y: event.clientY
});

// è·Ÿè¸ªè¡¨å•æäº¤
analyticsManager.trackFormSubmission(form, formData);

// è·Ÿè¸ªåŠŸèƒ½ä½¿ç”¨
analyticsManager.trackFeatureUsage('payment', {
    amount: 100,
    method: 'credit_card'
});
```

#### 3. é”™è¯¯ç›‘æ§
```javascript
// è‡ªåŠ¨è·Ÿè¸ªJavaScripté”™è¯¯
window.addEventListener('error', (event) => {
    analyticsManager.trackError(event.error, {
        filename: event.filename,
        lineno: event.lineno
    });
});

// æ‰‹åŠ¨è·Ÿè¸ªé”™è¯¯
analyticsManager.trackError(new Error('Custom error'), {
    context: 'user_action'
});
```

#### 4. A/Bæµ‹è¯•æ”¯æŒ
```javascript
// è·Ÿè¸ªA/Bæµ‹è¯•
analyticsManager.trackABTest('checkout_button', 'variant_a', false);
analyticsManager.trackABTest('checkout_button', 'variant_a', true);
```

#### 5. ç”¨æˆ·æ»¡æ„åº¦è°ƒæŸ¥
```javascript
// æ”¶é›†ç”¨æˆ·åé¦ˆ
analyticsManager.trackUserSatisfaction(5, {
    comment: 'Great experience!',
    category: 'overall'
});
```

### è‡ªåŠ¨è·Ÿè¸ªé…ç½®

```javascript
// åˆå§‹åŒ–æ—¶å¯ç”¨è‡ªåŠ¨è·Ÿè¸ª
const analyticsManager = new AnalyticsManager({
    autoTrack: true,          // å¯ç”¨è‡ªåŠ¨è·Ÿè¸ª
    sessionTimeout: 1800000,  // 30åˆ†é’Ÿä¼šè¯è¶…æ—¶
    batchSize: 10,           // æ‰¹é‡å‘é€10ä¸ªäº‹ä»¶
    sendInterval: 10000      // 10ç§’å‘é€é—´éš”
});
```

## ğŸ”§ å®‰è£…å’Œé…ç½®

### 1. å¼•å…¥è„šæœ¬
```html
<!-- åœ¨HTMLæ–‡ä»¶ä¸­å¼•å…¥ -->
<script src="/js/performance.js"></script>
<script src="/js/analytics.js"></script>
```

### 2. é…ç½®åˆ†ææœåŠ¡
```javascript
// é…ç½®åˆ†æAPIç«¯ç‚¹
window.analyticsManager = new AnalyticsManager({
    apiEndpoint: '/api/analytics',
    autoTrack: true,
    batchSize: 5,
    sendInterval: 5000
});
```

### 3. è®¾ç½®é”™è¯¯å¤„ç†
```javascript
// å¯ç”¨è‡ªåŠ¨é”™è¯¯è·Ÿè¸ª
AnalyticsUtils.setupClickTracking();
AnalyticsUtils.setupFormTracking();
AnalyticsUtils.setupScrollTracking();
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡è¯´æ˜

### æ ¸å¿ƒWeb Vitals

- **LCP (Largest Contentful Paint)**: æœ€å¤§å†…å®¹ç»˜åˆ¶æ—¶é—´
  - ä¼˜ç§€: < 2.5s
  - éœ€è¦æ”¹è¿›: 2.5s - 4.0s
  - è¾ƒå·®: > 4.0s

- **FID (First Input Delay)**: é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ
  - ä¼˜ç§€: < 100ms
  - éœ€è¦æ”¹è¿›: 100ms - 300ms
  - è¾ƒå·®: > 300ms

- **CLS (Cumulative Layout Shift)**: ç´¯ç§¯å¸ƒå±€åç§»
  - ä¼˜ç§€: < 0.1
  - éœ€è¦æ”¹è¿›: 0.1 - 0.25
  - è¾ƒå·®: > 0.25

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å›¾ç‰‡ä¼˜åŒ–**
   - ä½¿ç”¨WebPæ ¼å¼
   - å®ç°æ‡’åŠ è½½
   - è®¾ç½®é€‚å½“çš„å›¾ç‰‡å°ºå¯¸

2. **ä»£ç ä¼˜åŒ–**
   - å®ç°ä»£ç åˆ†å‰²
   - ä½¿ç”¨åŠ¨æ€å¯¼å…¥
   - å‡å°‘bundleå¤§å°

3. **ç¼“å­˜ç­–ç•¥**
   - å¯ç”¨APIå“åº”ç¼“å­˜
   - ä½¿ç”¨Service Worker
   - åˆç†è®¾ç½®ç¼“å­˜æ—¶é—´

## ğŸš¨ é”™è¯¯ç›‘æ§

ç³»ç»Ÿè‡ªåŠ¨ç›‘æ§ä»¥ä¸‹ç±»å‹çš„é”™è¯¯ï¼š

- JavaScriptè¿è¡Œæ—¶é”™è¯¯
- Promiseæ‹’ç»é”™è¯¯
- ç½‘ç»œè¯·æ±‚é”™è¯¯
- èµ„æºåŠ è½½é”™è¯¯
- å†…å­˜æ³„æ¼è­¦å‘Š

## ğŸ“Š æ•°æ®åˆ†æ

### æ”¶é›†çš„æ•°æ®ç±»å‹

1. **ç”¨æˆ·è¡Œä¸ºæ•°æ®**
   - é¡µé¢è®¿é—®
   - ç‚¹å‡»äº‹ä»¶
   - è¡¨å•æäº¤
   - æ»šåŠ¨è¡Œä¸º

2. **æ€§èƒ½æ•°æ®**
   - é¡µé¢åŠ è½½æ—¶é—´
   - APIå“åº”æ—¶é—´
   - èµ„æºåŠ è½½æ—¶é—´
   - å†…å­˜ä½¿ç”¨æƒ…å†µ

3. **é”™è¯¯æ•°æ®**
   - JavaScripté”™è¯¯
   - ç½‘ç»œé”™è¯¯
   - ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜

### éšç§ä¿æŠ¤

- æ•æ„Ÿæ•°æ®è‡ªåŠ¨è„±æ•
- ç”¨æˆ·IDä½¿ç”¨éšæœºç”Ÿæˆ
- ç¬¦åˆGDPRå’ŒCCPAè¦æ±‚

## ğŸ”„ æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–
```javascript
// ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµ
const debouncedSearch = PerformanceUtils.debounce(searchFunction, 300);
const throttledScroll = PerformanceUtils.throttle(scrollHandler, 100);

// é¢„åŠ è½½å…³é”®èµ„æº
performanceManager.preloadResource('/api/critical-data', 'fetch');

// ä½¿ç”¨ç¼“å­˜
const cachedData = performanceManager.getCachedApiResponse('user-profile');
```

### 2. è¡Œä¸ºåˆ†æ
```javascript
// è‡ªå®šä¹‰äº‹ä»¶è·Ÿè¸ª
analyticsManager.trackEvent('custom_action', {
    category: 'engagement',
    label: 'feature_x',
    value: 1
});

// åŠŸèƒ½ä½¿ç”¨ç»Ÿè®¡
analyticsManager.trackFeatureUsage('premium_feature', {
    usage_duration: 300,
    success: true
});
```

### 3. A/Bæµ‹è¯•
```javascript
// å®ç°A/Bæµ‹è¯•
if (Math.random() > 0.5) {
    showButtonVariantA();
    analyticsManager.trackABTest('button_test', 'variant_a');
} else {
    showButtonVariantB();
    analyticsManager.trackABTest('button_test', 'variant_b');
}
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ€§èƒ½æ•°æ®ä¸å‡†ç¡®**
   - ç¡®ä¿Performance Observeræ”¯æŒ
   - æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜

2. **åˆ†ææ•°æ®ä¸¢å¤±**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯APIç«¯ç‚¹é…ç½®
   - æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯

3. **å†…å­˜æ³„æ¼**
   - å®šæœŸè°ƒç”¨cleanup()æ–¹æ³•
   - ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
   - æ¸…ç†æœªä½¿ç”¨çš„ç›‘å¬å™¨

## ğŸ“š æ›´å¤šèµ„æº

- [MDN Performance API](https://developer.mozilla.org/en-US/docs/Web/API/Performance)
- [Web Vitalsæ–‡æ¡£](https://web.dev/vitals/)
- [Google Analytics 4](https://support.google.com/analytics/answer/10089681)

---

*æœ€åæ›´æ–°: 2025-11-05*