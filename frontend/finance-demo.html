<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>支出和支付管理系统</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="js/expenses.css">
    <link rel="stylesheet" href="js/payments.css">
    <link rel="stylesheet" href="js/balances.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>群组财务管理</h1>
            <nav>
                <button class="tab-btn active" data-tab="expenses">支出管理</button>
                <button class="tab-btn" data-tab="payments">支付管理</button>
                <button class="tab-btn" data-tab="balances">余额结算</button>
            </nav>
        </header>

        <!-- 支出管理模块 -->
        <div id="expenses-tab" class="tab-content active">
            <h2>支出管理</h2>
            
            <!-- 支出统计 -->
            <div class="expense-stats">
                <h3>支出统计</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="total-expenses">¥0.00</div>
                        <div class="stat-label">总支出</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="monthly-expenses">¥0.00</div>
                        <div class="stat-label">本月支出</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="expense-count">0</div>
                        <div class="stat-label">支出记录</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avg-expense">¥0.00</div>
                        <div class="stat-label">平均支出</div>
                    </div>
                </div>
            </div>

            <!-- 支出表单 -->
            <form id="expense-form" class="expense-form">
                <h3>添加支出</h3>
                <input type="hidden" name="id">
                <div class="form-group">
                    <label for="title">支出标题 *</label>
                    <input type="text" id="title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="amount">金额 *</label>
                    <input type="number" id="amount" name="amount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="category">分类</label>
                    <select id="category" name="category">
                        <option value="food">餐饮</option>
                        <option value="transport">交通</option>
                        <option value="shopping">购物</option>
                        <option value="entertainment">娱乐</option>
                        <option value="other">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="paymentMethod">支付方式</label>
                    <select id="paymentMethod" name="paymentMethod">
                        <option value="cash">现金</option>
                        <option value="transfer">转账</option>
                        <option value="alipay">支付宝</option>
                        <option value="wechat">微信</option>
                        <option value="bank">银行卡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>参与者分摊</label>
                    <div class="participants-container">
                        <div class="participant-field">
                            <select name="participant-user" class="participant-user-select">
                                <option value="">选择参与者</option>
                                <option value="user1">张三</option>
                                <option value="user2">李四</option>
                                <option value="user3">王五</option>
                            </select>
                            <input type="number" name="participant-amount" placeholder="分摊金额" step="0.01" min="0">
                            <button type="button" class="remove-participant">×</button>
                        </div>
                    </div>
                    <button type="button" id="add-participant" class="add-participant">+ 添加参与者</button>
                </div>
                <div class="form-group">
                    <label for="description">描述</label>
                    <textarea id="description" name="description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="receipt">收据图片</label>
                    <input type="file" id="receipt" name="receipt" accept="image/*">
                    <img id="receipt-preview" class="receipt-preview" alt="收据预览">
                </div>
                <div class="form-actions">
                    <button type="submit">保存支出</button>
                    <button type="reset">重置</button>
                </div>
            </form>

            <!-- 支出筛选 -->
            <div class="category-filter">
                <select id="category-filter">
                    <option value="">所有分类</option>
                    <option value="food">餐饮</option>
                    <option value="transport">交通</option>
                    <option value="shopping">购物</option>
                    <option value="entertainment">娱乐</option>
                    <option value="other">其他</option>
                </select>
            </div>

            <!-- 支出列表 -->
            <div id="expenses-list" class="expenses-list">
                <!-- 支出项目将在这里显示 -->
            </div>
        </div>

        <!-- 支付管理模块 -->
        <div id="payments-tab" class="tab-content">
            <h2>支付管理</h2>
            
            <!-- 支付统计 -->
            <div class="payment-stats">
                <h3>支付统计</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="total-payments">¥0.00</div>
                        <div class="stat-label">总支付金额</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="pending-payments">0</div>
                        <div class="stat-label">待确认</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="completed-payments">0</div>
                        <div class="stat-label">已完成</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="payment-count">0</div>
                        <div class="stat-label">支付记录</div>
                    </div>
                </div>
            </div>

            <!-- 支付表单 -->
            <form id="payment-form" class="payment-form">
                <h3>添加支付记录</h3>
                <div class="form-group">
                    <label for="fromUser">付款人 *</label>
                    <select id="fromUser" name="fromUser" required>
                        <option value="">选择付款人</option>
                        <option value="user1">张三</option>
                        <option value="user2">李四</option>
                        <option value="user3">王五</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="toUser">收款人 *</label>
                    <select id="toUser" name="toUser" required>
                        <option value="">选择收款人</option>
                        <option value="user1">张三</option>
                        <option value="user2">李四</option>
                        <option value="user3">王五</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">金额 *</label>
                    <input type="number" id="amount" name="amount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="paymentMethod">支付方式</label>
                    <select id="paymentMethod" name="paymentMethod">
                        <option value="cash">现金</option>
                        <option value="transfer">转账</option>
                        <option value="alipay">支付宝</option>
                        <option value="wechat">微信</option>
                        <option value="bank">银行卡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="referenceNumber">单号</label>
                    <input type="text" id="referenceNumber" name="referenceNumber">
                </div>
                <div class="form-group">
                    <label for="paymentDate">支付时间</label>
                    <input type="datetime-local" id="paymentDate" name="paymentDate">
                </div>
                <div class="form-group">
                    <label for="description">说明</label>
                    <textarea id="description" name="description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="proof">支付凭证</label>
                    <input type="file" id="proof" name="proof" accept="image/*,.pdf">
                    <img id="proof-preview" class="proof-preview" alt="凭证预览">
                </div>
                <div class="form-actions">
                    <button type="submit">保存支付</button>
                    <button type="reset">重置</button>
                </div>
            </form>

            <!-- 状态筛选和批量操作 -->
            <div class="status-filter">
                <select id="status-filter">
                    <option value="">所有状态</option>
                    <option value="pending">待确认</option>
                    <option value="processing">处理中</option>
                    <option value="completed">已完成</option>
                    <option value="failed">失败</option>
                    <option value="cancelled">已取消</option>
                </select>
                <label>
                    <input type="checkbox" id="select-all-payments"> 全选
                </label>
            </div>

            <!-- 批量操作工具栏 -->
            <div class="batch-actions">
                <div class="actions-info">已选择 <span id="selected-count">0</span> 条支付记录</div>
                <div class="actions-buttons">
                    <button id="batch-status-update">批量更新状态</button>
                    <button id="batch-delete">批量删除</button>
                </div>
            </div>

            <!-- 支付列表 -->
            <div id="payments-list" class="payments-list">
                <!-- 支付项目将在这里显示 -->
            </div>
        </div>

        <!-- 余额结算模块 -->
        <div id="balances-tab" class="tab-content">
            <h2>余额结算</h2>
            
            <!-- 工具栏 -->
            <div class="toolbar">
                <button id="refresh-balances" class="refresh-button">刷新余额</button>
                <button id="generate-suggestions" class="generate-button">生成结算建议</button>
                <div class="date-filter">
                    <label for="date-range-filter">时间范围:</label>
                    <select id="date-range-filter">
                        <option value="">全部</option>
                        <option value="week">最近一周</option>
                        <option value="month">最近一月</option>
                        <option value="quarter">最近三月</option>
                        <option value="year">最近一年</option>
                    </select>
                </div>
                <button id="export-report" class="export-button">导出报告</button>
                <button id="print-report" class="print-button">打印报告</button>
            </div>

            <!-- 余额容器 -->
            <div id="balances-container">
                <!-- 余额信息将在这里显示 -->
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/expenses.js"></script>
    <script src="js/payments.js"></script>
    <script src="js/balances.js"></script>
    <script>
        // 标签页切换功能
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;
                    
                    // 更新按钮状态
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // 更新内容显示
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(targetTab + '-tab').classList.add('active');
                });
            });

            // 初始化群组ID（实际使用时应该从URL或其他地方获取）
            const groupId = 'demo-group-123';
            expenseManager.setGroupId(groupId);
            paymentManager.setGroupId(groupId);
            balanceManager.setGroupId(groupId);

            // 添加参与者功能
            document.getElementById('add-participant').addEventListener('click', function() {
                const container = document.querySelector('.participants-container');
                expenseManager.addParticipantField(container);
            });

            // 表单重置时清理预览
            document.getElementById('expense-form').addEventListener('reset', function() {
                expenseManager.clearParticipantsForm(this);
                const preview = document.getElementById('receipt-preview');
                if (preview) preview.style.display = 'none';
                delete this.dataset.editingId;
            });

            document.getElementById('payment-form').addEventListener('reset', function() {
                paymentManager.clearProofPreview();
                delete this.dataset.editingId;
            });
        });
    </script>
</body>
</html>